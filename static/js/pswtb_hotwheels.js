var pswtb = pswtb || {};

pswtb.hotwheels = {
    labels: {
        'US': {
            'default': {
                languageStyle: 'ps_LanguageENStyle',
                header: 'HEADS UP!',
                paragraph: 'You are about to visit a web page that will display retailer pricing and availability and is intended for adults.',
                ok: 'keep going',
                cancel: 'back',
                wtbButton: 'WHERE TO BUY'
            }
        },

        'CA': {
            'default' : {
                languageStyle: 'ps_LanguageENStyle',
                header: 'HEADS UP!',
                paragraph: 'You are about to visit a web page that will display retailer pricing and availability and is intended for adults.',
                ok: 'keep going',
                cancel: 'back',
                wtbButton: 'WHERE TO BUY'
            },
            'FR' : {
                languageStyle: 'ps_LanguageFRStyle',
                header: 'LA TÊTE HAUTE!',
                paragraph: 'Vous êtes sur le point de visiter une page web qui affiche les prix et la disponibilité de détaillant et est destiné aux adultes.',
                ok: 'continuer',
                cancel: 'retour',
                wtbButton: 'OÙ ACHETER'
            }
        },

        'UK': {
            'default' : {
                languageStyle: 'ps_LanguageENStyle',
                header: 'HEADS UP!',
                paragraph: 'You are about to visit a web page that will display retailer pricing and availability and is intended for adults.',
                ok: 'keep going',
                cancel: 'back',
                wtbButton: 'WHERE TO BUY'
            }
        },

        'DE': {
            'default': {
                languageStyle: 'ps_LanguageDEStyle',
                header: 'ACHTUNG!',
                paragraph: 'Sie sind dabei, eine Webseite, die Händler zu Preisen und Verfügbarkeit angezeigt werden und ist für Erwachsene bestimmt besuchen.',
                ok: 'weitermachen',
                cancel: 'zurück',
                wtbButton: 'BEZUGSQUELLEN'
            }
        },

        'FR': {
            'default' : {
                languageStyle: 'ps_LanguageFRStyle',
                header: 'LA TÊTE HAUTE!',
                paragraph: 'Vous êtes sur le point de visiter une page web qui affiche les prix et la disponibilité de détaillant et est destiné aux adultes.',
                ok: 'continuer',
                cancel: 'retour',
                wtbButton: 'OÙ ACHETER'
            }
        },

        'RU': {
            'default' : {
                languageStyle: 'ps_LanguageRUStyle',
                header: 'БЕРЕГИСЬ!',
                paragraph: 'Вы собираетесь посетить веб-страницу, которая будет отображать цены и наличие розничной и предназначен для взрослых.',
                ok: 'продолжать',
                cancel: 'назад',
                wtbButton: 'ГДЕ КУПИТЬ'
            }
        },

        'ES': {
            'default' : {
                languageStyle: 'ps_LanguageESStyle',
                header: 'AVÍS!',
                paragraph: 'Vostè està a punt de visitar una pàgina web que mostrarà el preu minorista i la disponibilitat i està destinat als adults.',
                ok: 'contínua',
                cancel: 'esquena',
                wtbButton: 'ON COMPRAR'
            }
        },

        'CN': {
            'default' : {
                languageStyle: 'ps_LanguageCNStyle',
                header: '小心！',
                paragraph: '您要访问的网页将显示零售商的定价和可用性和适用于成人。',
                ok: '继续前进',
                cancel: '后',
                wtbButton: '购买地点'
            }
        },

        'IN': {
            'default' : {
                languageStyle: 'ps_LanguageENStyle',
                header: 'HEADS UP!',
                paragraph: 'You are about to visit a web page that will display retailer pricing and availability and is intended for adults.',
                ok: 'keep going',
                cancel: 'back',
                wtbButton: 'WHERE TO BUY'
            },
            'HI': {
                languageStyle: 'ps_LanguageHIStyle',
                header: 'सचेत!',
                paragraph: 'आप फुटकर बिक्री मूल्य निर्धारण और उपलब्धता प्रदर्शित करेगा और वयस्कों के लिए करना है कि एक वेब पेज का दौरा करने के बारे में हैं।',
                ok: 'चलते रहो',
                cancel: 'वापस',
                wtbButton: 'कहां खरीदें'
            }
        },

        'PT': {
            'default' : {
                languageStyle: 'ps_LanguagePTStyle',
                header: 'ATENÇÃO!',
                paragraph: 'Você está prestes a visitar uma página web que irá exibir preços varejista e disponibilidade e é destinado a adultos.',
                ok: 'Continue',
                cancel: 'de volta',
                wtbButton: 'ONDE COMPRAR'
            }
        },

        'PL': {
            'default': {
                languageStyle: 'ps_LanguagePLStyle',
                header: 'GŁOWY DO GÓRY!',
                paragraph: 'Masz zamiar odwiedzić stronę internetową, która będzie wyświetlana detalista i dostępności cenowej i jest przeznaczony dla osób dorosłych.',
                ok: 'tak trzymaj',
                cancel: 'z powrotem',
                wtbButton: 'GDZIE KUPIĆ'
            }
        },

        'NL': {
            'default' : {
                languageStyle: 'ps_LanguageNLStyle',
                header: 'HOOFDEN OMHOOG!',
                paragraph: 'Je gaat naar een webpagina die retailer prijzen en beschikbaarheid wordt weergegeven en is bedoeld voor volwassenen te bezoeken.',
                ok: 'ga zo door',
                cancel: 'terug',
                wtbButton: 'WAAR TE KOOP'
            }
        },

        'HK': {
            'default' : {
                languageStyle: 'ps_LanguageCNStyle',
                header: '小心！',
                paragraph: '您要访问的网页将显示零售商的定价和可用性和适用于成人。',
                ok: '继续前进',
                cancel: '后',
                wtbButton: '购买地点'
            }
        },

        'GR': {
            'default' : {
                languageStyle: 'ps_LanguageGRStyle',
                header: 'ΨΗΛΑ ΤΟ ΚΕΦΑΛΙ!',
                paragraph: 'Είστε έτοιμοι να επισκεφθείτε μια ιστοσελίδα που θα εμφανίσει τις τιμές λιανικής πώλησης και τη διαθεσιμότητα και προορίζεται για ενήλικες.',
                ok: 'συνέχισε',
                cancel: 'πίσω',
                wtbButton: 'ΠΟΥ ΝΑ ΑΓΟΡΑΣΕΤΕ'
            }
        },

        'TR': {
            'default' : {
                languageStyle: 'ps_LanguageTRStyle',
                header: 'DİKKAT ET!',
                paragraph: 'Sen perakendeci fiyatlandırma ve kullanılabilirlik görüntüler ve yetişkinler için tasarlanmış bir web sayfasını ziyaret etmek üzeresiniz.',
                ok: 'devam et',
                cancel: 'geri',
                wtbButton: 'NEREDEN ALINIR'
            }
        },

        'BR': {
            'default' : {
                languageStyle: 'ps_LanguagePTStyle',
                header: 'ATENÇÃO!',
                paragraph: 'Você está prestes a visitar uma página web que irá exibir preços varejista e disponibilidade e é destinado a adultos.',
                ok: 'Continue',
                cancel: 'de volta',
                wtbButton: 'ONDE COMPRAR'
            }
        },

        'AU': {
            'default' : {
                languageStyle: 'ps_LanguageENStyle',
                header: 'HEADS UP!',
                paragraph: 'You are about to visit a web page that will display retailer pricing and availability and is intended for adults.',
                ok: 'keep going',
                cancel: 'back',
                wtbButton: 'WHERE TO BUY'
            }
        },

        'JP': {
            'default' : {
                languageStyle: 'ps_LanguageJAStyle',
                header: '注意喚起！',
                paragraph: 'あなたが小売店の価格と可用性が表示され、大人を対象としたWebページを訪問しようとしています。',
                ok: '立ち止まりますな',
                cancel: 'バック',
                wtbButton: 'どこで購入します'
            }
        },

        'IT': {
            'default' : {
                languageStyle: 'ps_LanguageITStyle',
                header: 'A TESTA ALTA!',
                paragraph: 'Stai per visitare una pagina web che visualizzerà i prezzi rivenditore e disponibilità ed è destinato agli adulti.',
                ok: 'continua',
                cancel: 'indietro',
                wtbButton: 'DOVE ACQUISTARE'
            }
        },

        'KR': {
            'default' : {
                languageStyle: 'ps_LanguageKOStyle',
                header: '헤드 업!',
                paragraph: '당신은 소매 가격 및 가용성을 표시하고 성인을 대상으로 웹 페이지를 방문하려고합니다.',
                ok: '계속',
                cancel: '백',
                wtbButton: '어디에서 구매'
            }
        },

        'TW': {
            'default' : {
                languageStyle: 'ps_LanguageCNStyle',
                header: '小心！',
                paragraph: '您要访问的网页将显示零售商的定价和可用性和适用于成人。',
                ok: '继续前进',
                cancel: '后',
                wtbButton: '购买地点'
            }
        },

        'MX': {
            'default' : {
                languageStyle: 'ps_LanguageESStyle',
                header: 'AVISO!',
                paragraph: 'Usted está a punto de visitar una página web que mostrará el precio minorista y la disponibilidad y está destinado a los adultos.',
                ok: 'continua',
                cancel: 'espalda',
                wtbButton: 'DONDE COMPRAR'
            }
        }
    },

    dialogInnerHtml:
        '<div class="ps_ModalShadowStyle"></div>' +
        '<div class="ps_LightboxStyle {languageStyle}">' +
            '<div class="ps_ContentStyle">' +
                '<div class="ps_HotwheelsLogoStyle"></div>' +
                '<div class="ps_HeaderStyle">{header}</div>' +
                '<div class="ps_ParagraphStyle">{paragraph}</div>' +
                '<div class="ps_ButtonsStyle">' +
                    '<a class="ps_ButtonStyle" href="javascript:;" onclick="pswtb.hotwheels.closeDialog(true);">{cancel}</a>' +
                    '<a class="ps_ButtonStyle" href="javascript:;" onclick="pswtb.hotwheels.loadWTB(\'{sku}\');">{ok}</a>' +
                '</div>' +
            '</div>' +
        '</div>',

    format: function (mask, values)
    {
        if (mask && values && typeof (mask) === 'string')
        {
            var result = mask;
            for (var key in values)
            {
                var val = values[key];
                var replaceRegex = new RegExp('\\{' + key + '\\}|\\[' + key + '\\]', 'ig');
                result = result.replace(
                    replaceRegex,
                    val != null && val != undefined ? val : '');
            }

            return result;
        }
        else
            return mask;
    },

    getLabels: function(sku, languageOverride)
    {
        var s = pswtb.hotwheels;

        var skuOverride = location.search.match(/pssku=([^&]+)/i);
        var country = 
            skuOverride ? 
                skuOverride[1].substring(0, 2).toUpperCase() :
                sku ?
                    sku.substring(0, 2).toUpperCase() :
                    null;

        var urlLanguageOverride = location.search.match(/pslanguage=([^&]+)/i);
        var language = 
            urlLanguageOverride ? 
                urlLanguageOverride[1].toUpperCase() : 
                languageOverride ? 
                    languageOverride.toUpperCase() :
                    'default';

        var countryLabels = s.labels[country];

        if (!countryLabels)
            countryLabels = s.labels['US'];

        var result = countryLabels[language];

        return result ?
            result :
            countryLabels['default'];
    },

    showDialog: function (e)
    {
        var s = pswtb.hotwheels;
        if (s.dialog)
            s.closeDialog();
        else
        {
            var dialog = s.dialog = document.createElement('div');

            var labels = s.getLabels(e.data.sku, e.data.languageOverride);

            jQuery(dialog)
                .addClass('ps_WTBConfirmationDialogStyle ps_HiddenStyle')
                .html(s.format(s.dialogInnerHtml, {
                    'header': labels.header,
                    'paragraph': labels.paragraph,
                    'cancel': labels.cancel,
                    'ok': labels.ok,
                    'sku': e.data.sku,
                    'languageStyle': labels.languageStyle
                }))
                .appendTo(document.body)
                .fadeIn(350);

            s.windowResize();
        }
    },

    closeDialog: function (fadeOut)
    {
        var s = pswtb.hotwheels;
        if (s.dialog)
        {
            if (fadeOut)
                jQuery(s.dialog)
                    .fadeOut(350, function ()
                    {
                        jQuery(pswtb.hotwheels.dialog).remove();
                    });
            else
                jQuery(s.dialog).remove();

            delete s.dialog;
        }
    },

    loadWTB: function (sku)
    {
        var s = pswtb.hotwheels;
        jQuery(s.dialog).find('a.ps_ButtonStyle')
            .addClass('ps_DisabledStyle');

        jQuery(s.dialog).find('.ps_ContentStyle')
          .append('<div class="ps_LoadingStyle">loading...</div>');

        // load the standard Pricespider WTB
        pswtb.loader = {
            lsc: [], waitLoad: function ()
            {
                var e =
                pswtb.loader; if (e.finish)
                {
                    for (var t = 0; t < e.lsc.length; t++) e.finish(e.lsc[t].wcid); window
                    .clearInterval(e.waitLoadTimer); e.waitLoadTimer = null
                } else
                {
                    if (!e.waitLoadTimer) e.waitLoadTimer =
                    window.setInterval(e.waitLoad, 20)
                }
            }, show: function (e)
            {
                for (var t = 0; t < this.lsc.length; t++) if (this
                .lsc[t].wcid === e.widgetConfigurationId) { this.lsc[t].ops.push(e); return } var n = document
                .createElement("script"); n.type = "text/javascript"; var r = e.server; n.language = "javascript"; n.src =
                (r ? (r.match(/\/\//) ? "" : "//") + r + (r.charAt(r.length - 1) === "/" ? "" : "/") : "//embedded.pricespider.com/")
                + "WidgetScript.psjs?d=al&wc=" + e.widgetConfigurationId; this.lsc.push({
                    wcid: e.
                    widgetConfigurationId, ops: [e]
                }); if (navigator.userAgent.match(/msie [6-7]/i))
                {
                    document.write('<'
                    + 'script type="' + n.type + '" src="' + n.src.replace(/d=al&/i, "") + '"><' + "/script>"); this.waitLoad();
                    return
                } var i = navigator.userAgent.match(/msie [8-9]/i); n.async = true; if (i) n.onreadystatechange =
                new Function("if ((/loaded|completed/i).test(this.readyState)) pswtb.loader.finish('" + e.
                widgetConfigurationId + "');"); else n.onload = new Function("pswtb.loader.finish('" + e.
                widgetConfigurationId + "');"); (i ? document.getElementsByTagName("head")[0] : document.body)
                .appendChild(n)
            }
        };

        jQuery.each(s.wtbDetails, function (i, wtb)
        {
            pswtb.loader.show({
                container: wtb.container,
                widgetConfigurationId: '87ac045a-fe45-47a5-a5d2-48c685d7d48e',
                sku: wtb.sku,
                open: sku == wtb.sku
            });
        });
    },

    windowResize: function()
    {
        var s = pswtb.hotwheels;
        if (s.dialog)
        {
            var $lightbox = jQuery(s.dialog).find('.ps_LightboxStyle');

            $lightbox.css({
                'margin-top': Math.floor((jQuery(window).height() - $lightbox.height()) / 2) + 'px'
            });
        }
    },

    showDummyWTBButton: function (container, sku, languageOverride)
    {
        // render a dummy WTB button which opens the confirmation dialog
        if (!container)
            throw 'container is not specified';

        if (!sku)
            throw 'sku is not specified';

        var s = pswtb.hotwheels;

        if (!pswtb.hotwheels.wtbDetails)
            pswtb.hotwheels.wtbDetails = [];

        var skuOverride = location.search.match(/pssku=([^&]+)/i);
        var useSku = skuOverride ? skuOverride[1] : sku;

        pswtb.hotwheels.wtbDetails.push({
            container: container,
            sku: useSku
        });

        s.wtbButton = s.wtbButton || [];

        var labels = s.getLabels(sku, languageOverride);

        dummyBtn = document.createElement('a');
        jQuery(dummyBtn)
          .appendTo(container)
          .addClass('ps_WtbButtonStyle ps_DummyStyle')
          .html(labels.wtbButton)
          .click(
            { 
                sku: useSku,
              languageOverride: languageOverride
            }, 
            s.showDialog);

        s.wtbButton.push(dummyBtn);

        // preload the dialog background to avoid flash on
        var bg = document.createElement('img');
        jQuery(bg).attr({
            src: '//www.hotwheels.com/Static/img/interstitials/bg-interstitials-external-links-desktop.jpg',
        });

        if (!s.onResizeSet)
        {
            jQuery(window).resize(s.windowResize);
            s.onResizeSet = true;
        }
    }
};